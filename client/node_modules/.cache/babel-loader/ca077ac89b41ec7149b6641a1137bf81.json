{"ast":null,"code":"var _jsxFileName = \"/Users/husnimbark/Documents/Books/ways-books/client/src/pages/Complain.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { Container, Row, Col } from \"react-bootstrap\";\nimport NavbarUser from \"../components/navbar/NavbarUser\";\nimport Contact from \"../components/complain/Contact\";\nimport Chat from \"../components/complain/Chat\";\nimport { UserContext } from \"../context/UserContext\";\nimport { io } from \"socket.io-client\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nlet socket;\nexport default function Complain() {\n  _s();\n\n  const [contact, setContact] = useState(null);\n  const [contacts, setContacts] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const title = \"Complain admin\";\n  document.title = \"DumbMerch | \" + title;\n  const [state] = useContext(UserContext);\n  useEffect(() => {\n    socket = io(\"http://localhost:4000\", {\n      auth: {\n        token: localStorage.getItem(\"token\")\n      },\n      query: {\n        id: state.user.id\n      }\n    });\n    socket.on(\"new message\", () => {\n      socket.emit(\"load messages\", contact === null || contact === void 0 ? void 0 : contact.id);\n    });\n    socket.on(\"connect_error\", err => {\n      console.error(err.message);\n    });\n    loadContact();\n    loadMessages();\n    return () => {\n      socket.disconnect();\n    };\n  }, [messages]);\n\n  const loadContact = () => {\n    socket.emit(\"load admin contact\");\n    socket.on(\"admin contact\", async data => {\n      const dataContact = { ...data,\n        message: messages.length > 0 ? messages[messages.length - 1].message : \"Click here to start message\"\n      };\n      setContacts([dataContact]);\n    });\n  };\n\n  const onClickContact = data => {\n    setContact(data);\n    socket.emit(\"load messages\", data.id);\n  };\n\n  const loadMessages = value => {\n    socket.on(\"messages\", async data => {\n      if (data.length > 0) {\n        const dataMessages = data.map(item => ({\n          idSender: item.sender.id,\n          message: item.message\n        }));\n        setMessages(dataMessages);\n      }\n\n      const chatMessagesElm = document.getElementById(\"chat-messages\");\n      chatMessagesElm.scrollTop = chatMessagesElm === null || chatMessagesElm === void 0 ? void 0 : chatMessagesElm.scrollHeight;\n    });\n  };\n\n  const onSendMessage = e => {\n    if (e.key === \"Enter\") {\n      const data = {\n        idRecipient: contact.id,\n        message: e.target.value\n      };\n      socket.emit(\"send message\", data);\n      e.target.value = \"\";\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(NavbarUser, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Container, {\n      style: {\n        height: \"89.5vh\"\n      },\n      children: /*#__PURE__*/_jsxDEV(Row, {\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          md: 3,\n          style: {\n            height: \"89.5vh\"\n          },\n          className: \"px-3 bg-light overflow-auto rounded-s my-5 rounded-end\",\n          children: /*#__PURE__*/_jsxDEV(Contact, {\n            dataContact: contacts,\n            clickContact: onClickContact,\n            contact: contact\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          md: 9,\n          style: {\n            maxHeight: \"89.5vh\"\n          },\n          className: \"px-0 bg-secondary mt-5 rounded-s rounded-start\",\n          children: /*#__PURE__*/_jsxDEV(Chat, {\n            contact: contact,\n            messages: messages,\n            user: state.user,\n            sendMessage: onSendMessage\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\n_s(Complain, \"IpsBNlelvB8JGYxQE56IoXtLVEI=\");\n\n_c = Complain;\n\nvar _c;\n\n$RefreshReg$(_c, \"Complain\");","map":{"version":3,"names":["React","useState","useEffect","useContext","Container","Row","Col","NavbarUser","Contact","Chat","UserContext","io","socket","Complain","contact","setContact","contacts","setContacts","messages","setMessages","title","document","state","auth","token","localStorage","getItem","query","id","user","on","emit","err","console","error","message","loadContact","loadMessages","disconnect","data","dataContact","length","onClickContact","value","dataMessages","map","item","idSender","sender","chatMessagesElm","getElementById","scrollTop","scrollHeight","onSendMessage","e","key","idRecipient","target","height","maxHeight"],"sources":["/Users/husnimbark/Documents/Books/ways-books/client/src/pages/Complain.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport { Container, Row, Col } from \"react-bootstrap\";\n\nimport NavbarUser from \"../components/navbar/NavbarUser\";\n\nimport Contact from \"../components/complain/Contact\";\n\nimport Chat from \"../components/complain/Chat\";\n\nimport { UserContext } from \"../context/UserContext\";\n\nimport { io } from \"socket.io-client\";\n\nlet socket;\nexport default function Complain() {\n  const [contact, setContact] = useState(null);\n  const [contacts, setContacts] = useState([]);\n  const [messages, setMessages] = useState([]);\n\n  const title = \"Complain admin\";\n  document.title = \"DumbMerch | \" + title;\n\n  const [state] = useContext(UserContext);\n\n  useEffect(() => {\n    socket = io(\"http://localhost:4000\", {\n      auth: {\n        token: localStorage.getItem(\"token\"),\n      },\n      query: {\n        id: state.user.id,\n      },\n    });\n\n    socket.on(\"new message\", () => {\n      socket.emit(\"load messages\", contact?.id);\n    });\n\n    socket.on(\"connect_error\", (err) => {\n      console.error(err.message);\n    });\n    loadContact();\n    loadMessages();\n\n    return () => {\n      socket.disconnect();\n    };\n  }, [messages]);\n\n  const loadContact = () => {\n    socket.emit(\"load admin contact\");\n    socket.on(\"admin contact\", async (data) => {\n      const dataContact = {\n        ...data,\n        message:\n          messages.length > 0\n            ? messages[messages.length - 1].message\n            : \"Click here to start message\",\n      };\n      setContacts([dataContact]);\n    });\n  };\n\n  const onClickContact = (data) => {\n    setContact(data);\n    socket.emit(\"load messages\", data.id);\n  };\n\n  const loadMessages = (value) => {\n    socket.on(\"messages\", async (data) => {\n      if (data.length > 0) {\n        const dataMessages = data.map((item) => ({\n          idSender: item.sender.id,\n          message: item.message,\n        }));\n\n        setMessages(dataMessages);\n      }\n      const chatMessagesElm = document.getElementById(\"chat-messages\");\n      chatMessagesElm.scrollTop = chatMessagesElm?.scrollHeight;\n    });\n  };\n  const onSendMessage = (e) => {\n    if (e.key === \"Enter\") {\n      const data = {\n        idRecipient: contact.id,\n        message: e.target.value,\n      };\n\n      socket.emit(\"send message\", data);\n      e.target.value = \"\";\n    }\n  };\n\n  return (\n    <>\n      <NavbarUser />\n      <Container style={{ height: \"89.5vh\" }}>\n        <Row>\n          <Col\n            md={3}\n            style={{ height: \"89.5vh\" }}\n            className=\"px-3 bg-light overflow-auto rounded-s my-5 rounded-end\"\n          >\n            <Contact\n              dataContact={contacts}\n              clickContact={onClickContact}\n              contact={contact}\n            />\n          </Col>\n          <Col md={9} style={{ maxHeight: \"89.5vh\" }} className=\"px-0 bg-secondary mt-5 rounded-s rounded-start\">\n            <Chat\n              contact={contact}\n              messages={messages}\n              user={state.user}\n              sendMessage={onSendMessage}\n            />\n          </Col>\n        </Row>\n      </Container>\n    </>\n  );}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}