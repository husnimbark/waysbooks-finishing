{"ast":null,"code":"var _jsxFileName = \"/Users/husnimbark/Documents/Books/ways-books/client/src/pages/ComplainAdmin.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { Container, Row, Col } from \"react-bootstrap\";\nimport NavbarAdmin from \"../components/navbar/NavbarAdmin\";\nimport Contact from \"../components/complain/Contact\";\nimport Chat from \"../components/complain/Chat\";\nimport { UserContext } from \"../context/UserContext\";\nimport { io } from \"socket.io-client\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nlet socket;\nexport default function ComplainAdmin() {\n  _s();\n\n  const [contact, setContact] = useState(null);\n  const [contacts, setContacts] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const title = \"Complain admin\";\n  document.title = \"DumbMerch | \" + title;\n  const [state] = useContext(UserContext);\n  useEffect(() => {\n    socket = io(\"http://localhost:4000\", {\n      auth: {\n        token: localStorage.getItem(\"token\")\n      },\n      query: {\n        id: state.user.id\n      }\n    });\n    socket.on(\"new message\", () => {\n      socket.emit(\"load messages\", contact === null || contact === void 0 ? void 0 : contact.id);\n    });\n    loadContacts();\n    loadMessages();\n    return () => {\n      socket.disconnect();\n    };\n  }, [messages]);\n\n  const loadContacts = () => {\n    socket.emit(\"load customer contacts\");\n    socket.on(\"customer contacts\", data => {\n      let dataContacts = data.filter(item => item.status !== \"admin\" && (item.recipientMessage.length > 0 || item.senderMessage.length > 0));\n      dataContacts = dataContacts.map(item => ({ ...item,\n        message: item.senderMessage.length > 0 ? item.senderMessage[item.senderMessage.length - 1].message : \"Click here to start message\"\n      }));\n      setContacts(dataContacts);\n    });\n  };\n\n  const onClickContact = data => {\n    setContact(data);\n    socket.emit(\"load messages\", data.id);\n  };\n\n  const loadMessages = value => {\n    socket.on(\"messages\", data => {\n      if (data.length > 0) {\n        const dataMessages = data.map(item => ({\n          idSender: item.sender.id,\n          message: item.message\n        }));\n        setMessages(dataMessages);\n      }\n\n      loadContacts();\n      const chatMessagesElm = document.getElementById(\"chat-messages\");\n      chatMessagesElm.scrollTop = chatMessagesElm === null || chatMessagesElm === void 0 ? void 0 : chatMessagesElm.scrollHeight;\n    });\n  };\n\n  const onSendMessage = e => {\n    if (e.key === \"Enter\") {\n      const data = {\n        idRecipient: contact.id,\n        message: e.target.value\n      };\n      socket.emit(\"send message\", data);\n      e.target.value = \"\";\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(NavbarAdmin, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Container, {\n      style: {\n        height: \"89.5vh\"\n      },\n      children: /*#__PURE__*/_jsxDEV(Row, {\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          md: 3,\n          style: {\n            height: \"89.5vh\"\n          },\n          className: \"px-3 bg-dark text-white overflow-auto rounded-s rounded-end my-5\",\n          children: /*#__PURE__*/_jsxDEV(Contact, {\n            dataContact: contacts,\n            clickContact: onClickContact,\n            contact: contact\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          md: 9,\n          style: {\n            maxHeight: \"89.5vh\"\n          },\n          className: \"px-0 bg-secondary mt-5 rounded-s rounded-start\",\n          children: /*#__PURE__*/_jsxDEV(Chat, {\n            contact: contact,\n            messages: messages,\n            user: state.user,\n            sendMessage: onSendMessage\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\n_s(ComplainAdmin, \"IpsBNlelvB8JGYxQE56IoXtLVEI=\");\n\n_c = ComplainAdmin;\n\nvar _c;\n\n$RefreshReg$(_c, \"ComplainAdmin\");","map":{"version":3,"names":["React","useState","useEffect","useContext","Container","Row","Col","NavbarAdmin","Contact","Chat","UserContext","io","socket","ComplainAdmin","contact","setContact","contacts","setContacts","messages","setMessages","title","document","state","auth","token","localStorage","getItem","query","id","user","on","emit","loadContacts","loadMessages","disconnect","data","dataContacts","filter","item","status","recipientMessage","length","senderMessage","map","message","onClickContact","value","dataMessages","idSender","sender","chatMessagesElm","getElementById","scrollTop","scrollHeight","onSendMessage","e","key","idRecipient","target","height","maxHeight"],"sources":["/Users/husnimbark/Documents/Books/ways-books/client/src/pages/ComplainAdmin.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport { Container, Row, Col } from \"react-bootstrap\";\n\nimport NavbarAdmin from \"../components/navbar/NavbarAdmin\";\n\nimport Contact from \"../components/complain/Contact\";\nimport Chat from \"../components/complain/Chat\";\n\nimport { UserContext } from \"../context/UserContext\";\n\nimport { io } from \"socket.io-client\";\n\nlet socket;\nexport default function ComplainAdmin() {\n  const [contact, setContact] = useState(null);\n  const [contacts, setContacts] = useState([]);\n  const [messages, setMessages] = useState([]);\n\n  const title = \"Complain admin\";\n  document.title = \"DumbMerch | \" + title;\n\n  const [state] = useContext(UserContext);\n\n  useEffect(() => {\n    socket = io(\"http://localhost:4000\", {\n      auth: {\n        token: localStorage.getItem(\"token\"),\n      },\n      query: {\n        id: state.user.id,\n      },\n    });\n\n    socket.on(\"new message\", () => {\n      socket.emit(\"load messages\", contact?.id);\n    });\n\n    loadContacts();\n    loadMessages();\n\n    return () => {\n      socket.disconnect();\n    };\n  }, [messages]);\n\n  const loadContacts = () => {\n    socket.emit(\"load customer contacts\");\n    socket.on(\"customer contacts\", (data) => {\n      let dataContacts = data.filter(\n        (item) =>\n          item.status !== \"admin\" &&\n          (item.recipientMessage.length > 0 || item.senderMessage.length > 0)\n      );\n\n      dataContacts = dataContacts.map((item) => ({\n        ...item,\n        message:\n          item.senderMessage.length > 0\n            ? item.senderMessage[item.senderMessage.length - 1].message\n            : \"Click here to start message\",\n      }));\n      setContacts(dataContacts);\n    });\n  };\n\n  const onClickContact = (data) => {\n    setContact(data);\n    socket.emit(\"load messages\", data.id);\n  };\n\n  const loadMessages = (value) => {\n    socket.on(\"messages\", (data) => {\n      if (data.length > 0) {\n        const dataMessages = data.map((item) => ({\n          idSender: item.sender.id,\n          message: item.message,\n        }));\n        setMessages(dataMessages);\n      }\n      loadContacts();\n      const chatMessagesElm = document.getElementById(\"chat-messages\");\n      chatMessagesElm.scrollTop = chatMessagesElm?.scrollHeight;\n    });\n  };\n\n  const onSendMessage = (e) => {\n    if (e.key === \"Enter\") {\n      const data = {\n        idRecipient: contact.id,\n        message: e.target.value,\n      };\n\n      socket.emit(\"send message\", data);\n      e.target.value = \"\";\n    }\n  };\n\n  return (\n    <>\n      <NavbarAdmin  />\n      <Container style={{ height: \"89.5vh\" }}>\n        <Row>\n          <Col\n            md={3}\n            style={{ height: \"89.5vh\" }}\n            className=\"px-3 bg-dark text-white overflow-auto rounded-s rounded-end my-5\"\n          >\n            <Contact\n              dataContact={contacts}\n              clickContact={onClickContact}\n              contact={contact}\n            />\n          </Col>\n          <Col md={9} style={{ maxHeight: \"89.5vh\" }} className=\"px-0 bg-secondary mt-5 rounded-s rounded-start\">\n            <Chat\n              contact={contact}\n              messages={messages}\n              user={state.user}\n              sendMessage={onSendMessage}\n            />\n          </Col>\n        </Row>\n      </Container>\n    </>\n  );\n  }\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}